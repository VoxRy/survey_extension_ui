<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Question container modifications -->
    <template id="question_container" inherit_id="survey.question_container">
        <!-- Add the o_custom_survey_extensions_note class if type is note -->
        <xpath expr="//div[@t-att-id='question.id']" position="attributes">
            <attribute name="t-att-class">'js_question-wrapper pb-4 %s %s %s' % ('d-none' if not display_question else '', 'mr-2' if extra_right_margin else '', 'o_custom_survey_extensions_note' if question.question_type == 'note' else '')</attribute>
        </xpath>

        <!-- Inject note template call -->
        <xpath expr="//div[@t-att-id='question.id']" position="inside">
            <t t-if="question.question_type == 'note'">
                <t t-call="survey_extension_ui.question_note"/>
            </t>
        </xpath>
    </template>

    <template id="question_note" name="Question: Note">
        <!-- Static text block dummy input to keep JS logic working -->
        <div class="o_custom_survey_extensions_note_dummy">
            <input type="hidden" t-att-name="question.id" value="note" class="o_survey_form_choice_item"/>
        </div>
    </template>

    <!-- Override simple_choice rendering to support dropdown display -->
    <template id="question_simple_choice" inherit_id="survey.question_simple_choice">
        <xpath expr="//div[@data-question-type='simple_choice_radio']" position="replace">
            <!-- Original radio button rendering (customized style) -->
            <t t-set="answer_line" t-value="answer_lines.filtered(lambda line: line.suggested_answer_id)"/>
            <t t-set="comment_line" t-value="answer_lines.filtered(lambda line: line.value_char_box)"/>
            <div class="row o_survey_form_choice"
                 t-att-data-name="question.id"
                 data-question-type="simple_choice_radio">
                <t t-set="item_idx" t-value="0"/>
                <div t-attf-class="col-lg-12 d-flex flex-wrap">
                    <t t-set="has_correct_answer" t-value="scoring_display_correction and any(label.is_correct for label in question.suggested_answer_ids)"/>
                    <t t-foreach='question.suggested_answer_ids' t-as='label'>
                        <t t-set="item_idx" t-value="label_index"/>
                        <t t-set="answer_selected" t-value="answer_line and answer_line.suggested_answer_id.id == label.id"/>
                        <t t-set="is_correct" t-value="label.is_correct"/>

                        <!--Used for print mode with corrections -->
                        <t t-set="answer_class" t-if="not has_correct_answer" t-value="''" />
                        <t t-set="answer_class" t-elif="is_correct" t-value="'bg-success'" />
                        <t t-set="answer_class" t-elif="not is_correct" t-value="'bg-danger'" />

                        <label t-att-for="str(question.id) + '_' + str(label.id)"
                               t-att-class="'o_survey_choice_btn mr-2 mb-2 py-1 px-3 rounded %s %s' % (answer_class, 'o_survey_selected' if answer_selected else '')">
                            <t t-call="survey.survey_selection_key">
                                <t t-set="selection_key_class" t-value="'position-relative o_survey_radio_btn float-left d-flex'"/>
                            </t>
                            <span class="ml-2 text-break" t-field='label.value'/>
                            <input t-att-id="str(question.id) + '_' + str(label.id)" type="radio" t-att-value='label.id' class="o_survey_form_choice_item invisible position-absolute"
                                   t-att-name='question.id'
                                   t-att-checked="answer_line and answer_line.suggested_answer_id.id == label.id and 'checked' or None"
                                   t-att-data-selection-key="letters[item_idx] if useKeySelection else ''"/>
                            <i class="fa fa-check-circle float-right mt-1 position-relative"></i>
                            <i class="fa fa-circle-thin float-right mt-1 position-relative"></i>
                            <t t-call="survey.question_suggested_value_image"/>
                        </label>
                    </t>
                </div>
                <div t-if='question.comments_allowed and question.comment_count_as_answer' class="js_comments col-lg-12" >
                    <div class="d-flex flex-wrap">
                        <label t-att-class="'o_survey_choice_btn mr-2 py-1 px-3 rounded %s' % ('o_survey_selected' if comment_line else '')">
                            <t t-set="item_idx" t-value="item_idx + 1"/>
                            <t t-call="survey.survey_selection_key">
                                <t t-set="selection_key_class" t-value="'position-relative o_survey_radio_btn float-left d-flex'"/>
                            </t>
                            <span class="ml-2" t-esc="question.comments_message"/>
                            <input type="radio" t-att-value="'-1'" class="o_survey_form_choice_item invisible position-absolute"
                                   t-att-name='question.id'
                                   t-att-checked="comment_line and 'checked' or None"
                                   t-att-data-selection-key="letters[item_idx] if useKeySelection else ''"/>
                            <i class="fa fa-check-circle float-right mt-1 position-relative"></i>
                            <i class="fa fa-circle-thin float-right mt-1 position-relative"></i>
                        </label>
                    </div>
                    <input type="text" class="form-control o_survey_comment mt-2" t-att-name="str(question.id) + '_comment'" t-att-value="comment_line.value_char_box if comment_line else ''" placeholder="Cevabınız..."/>
                </div>
            </div>
        </xpath>
    </template>
</odoo>
